

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.4. Creating a New Descriptor &mdash; astrodata documentation v1.0beta documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="astrodata documentation v1.0beta documentation" href="index.html" />
    <link rel="up" title="4. AstroData Configuration Package Development Guide" href="developmentGuide.html" />
    <link rel="next" title="4.5. Creating Recipes and Primitive" href="creatingAPrimitive.html" />
    <link rel="prev" title="4.3. Creating An AstroDataType" href="creatingAnAstroDataType.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="creatingAPrimitive.html" title="4.5. Creating Recipes and Primitive"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="creatingAnAstroDataType.html" title="4.3. Creating An AstroDataType"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">astrodata documentation v1.0beta documentation</a> &raquo;</li>
          <li><a href="developmentGuide.html" accesskey="U">4. AstroData Configuration Package Development Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.4. Creating a New Descriptor</a><ul>
<li><a class="reference internal" href="#the-calculator-class">4.4.1. The Calculator Class</a></li>
<li><a class="reference internal" href="#the-calculator-index">4.4.2. The Calculator Index</a></li>
<li><a class="reference internal" href="#the-descriptorlist-py">4.4.3. The DescriptorList.py</a><ul>
<li><a class="reference internal" href="#the-descriptorlist-py-file">4.4.3.1. The DescriptorList.py File</a></li>
<li><a class="reference internal" href="#adding-the-descriptor-function-to-the-calculatorclass">4.4.3.2. Adding the Descriptor Function to the CalculatorClass</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="creatingAnAstroDataType.html"
                        title="previous chapter">4.3. Creating An AstroDataType</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="creatingAPrimitive.html"
                        title="next chapter">4.5. Creating Recipes and Primitive</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/creatingADescriptor.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-a-new-descriptor">
<h1>4.4. Creating a New Descriptor<a class="headerlink" href="#creating-a-new-descriptor" title="Permalink to this headline">¶</a></h1>
<p>The Descriptor implementations are defined in the
<tt class="docutils literal"><span class="pre">astrodata_Sample/ADCONFIG_Sample/descriptors</span></tt> directory tree. A descriptor
configuration requires the following elements:</p>
<ol class="arabic simple">
<li>There must be a &#8220;Calculator&#8221; object in which the descriptor function must be
defined (as a method).</li>
<li>The Calculator class must appear in a &#8220;calculator index&#8221;, which are any files
in the <tt class="docutils literal"><span class="pre">descriptors</span></tt> directory tree named <tt class="docutils literal"><span class="pre">calculatorIndex.&lt;whatever&gt;.py</span></tt>
where <tt class="docutils literal"><span class="pre">&lt;whatever&gt;</span></tt> can be any unique name.</li>
<li>The descriptor must be listed in the <tt class="docutils literal"><span class="pre">DescriptorsList.py</span></tt> file.</li>
</ol>
<div class="section" id="the-calculator-class">
<h2>4.4.1. The Calculator Class<a class="headerlink" href="#the-calculator-class" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">Calculator</span></tt> Class in the Sample package is, for the OBSERVED type, in the file
<tt class="docutils literal"><span class="pre">OBSERVED_Descriptors.py</span></tt>. That file is located in the <tt class="docutils literal"><span class="pre">descriptors</span></tt> subdirectory of the
<tt class="docutils literal"><span class="pre">ADCONFIG_Sample</span></tt> of the <tt class="docutils literal"><span class="pre">astrodata_Sample</span></tt> package.
It contains just one example descriptor function, <tt class="docutils literal"><span class="pre">observatory</span></tt> which relies
on the standard MEF PHU key, <tt class="docutils literal"><span class="pre">OBSERVAT</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OBSERVED_DescriptorCalc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">observatory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_phu_key_value</span><span class="p">(</span><span class="s">&quot;OBSERVAT&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In order for this function to be called for the right type of data, this class
must appear in a &#8220;calculator index&#8221;.</p>
</div>
<div class="section" id="the-calculator-index">
<h2>4.4.2. The Calculator Index<a class="headerlink" href="#the-calculator-index" title="Permalink to this headline">¶</a></h2>
<p>The Calculator Index for astrodata_Sample is located in the file,
<tt class="docutils literal"><span class="pre">calculatorIndex.Sample.py</span></tt>, in the <tt class="docutils literal"><span class="pre">descriptors</span></tt> subdirectory of
<tt class="docutils literal"><span class="pre">ADCONFIG_Sample</span></tt> in the <tt class="docutils literal"><span class="pre">astrodata_Sample</span></tt> configuration package.</p>
<p>Here is the source:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">calculatorIndex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;OBSERVED&quot;</span><span class="p">:</span><span class="s">&quot;OBSERVED_Descriptors.OBSERVED_DescriptorCalc()&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Note, the sample index also contains detailed instructions about the format but
for our purposes the index should be clear enough.  The dictionary key is the
string name of a defined AstroData Type, and the value is the class name,
including the module it is defined in.  The system will parse this name and
import the <tt class="docutils literal"><span class="pre">OBSERVED_Descriptors</span></tt> module, then store the class in a calculator
dictionary.</p>
</div>
<div class="section" id="the-descriptorlist-py">
<h2>4.4.3. The DescriptorList.py<a class="headerlink" href="#the-descriptorlist-py" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">DescriptorList.py</span></tt> file contains  a list of descriptors definitions.
The entries
declared must at least declare the name of the new descriptor function.  The
infrastructure will use these names to create a bridge between AstroData instances and
the type-specific descriptor functions.</p>
<p>Adding a New Descriptor to the configuration involves:</p>
<ol class="arabic simple">
<li>Adding a &#8220;DescriptorDescriptor&#8221; to the DescriptorList.py file.</li>
<li>Adding the descriptor function to the appropriate Descriptor Calculator class.</li>
</ol>
<div class="section" id="the-descriptorlist-py-file">
<h3>4.4.3.1. The DescriptorList.py File<a class="headerlink" href="#the-descriptorlist-py-file" title="Permalink to this headline">¶</a></h3>
<p>The contents of <tt class="docutils literal"><span class="pre">DescriptorList.py</span></tt> is a list of &#8220;DD&#8221; object constructors, as follows
from the astrodata_Sample package:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
  <span class="n">DD</span><span class="p">(</span><span class="s">&quot;observatory&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>To add a descriptor named &#8220;telescope&#8221; we&#8217;d add the following line to the <tt class="docutils literal"><span class="pre">DescriptorList.py</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DD</span><span class="p">(</span><span class="s">&quot;telescope&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells the infrastructure the name of the descriptor, and in more complicated cases can provide other descriptor
metadata to the infrastructure.  The final file would look as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
  <span class="n">DD</span><span class="p">(</span><span class="s">&quot;observatory&quot;</span><span class="p">),</span>
  <span class="n">DD</span><span class="p">(</span><span class="s">&quot;telescope&quot;</span><span class="p">)</span>
 <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-the-descriptor-function-to-the-calculatorclass">
<h3>4.4.3.2. Adding the Descriptor Function to the CalculatorClass<a class="headerlink" href="#adding-the-descriptor-function-to-the-calculatorclass" title="Permalink to this headline">¶</a></h3>
<p>To add the descriptor once the descriptor is present in the <tt class="docutils literal"><span class="pre">DescriptorList.py</span></tt> one merely needs to add a function to the
appropriate DescriptorCalculator class. The contents of
<tt class="docutils literal"><span class="pre">OBSERVED_Descriptors.py</span></tt> module in the astrodata_Sample
configuration is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OBSERVED_DescriptorCalc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">observatory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_phu_key_value</span><span class="p">(</span><span class="s">&quot;OBSERVAT&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To add the &#8220;telescope&#8221; descriptor means adding another function to this class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">telescope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_phu_key_value</span><span class="p">(</span><span class="s">&quot;TELESCOP&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All descriptors should have the same function signature,  including
<tt class="docutils literal"><span class="pre">self</span></tt>, a <tt class="docutils literal"><span class="pre">dataset</span></tt> argument and <tt class="docutils literal"><span class="pre">**args</span></tt> to catch all named arguments.
The latter is required by the infrastructure so that unexpected parameters
can be sent to all descriptor algorithms, some of which may be handled by the
infrastructure on behalf of the descriptor function.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="creatingAPrimitive.html" title="4.5. Creating Recipes and Primitive"
             >next</a> |</li>
        <li class="right" >
          <a href="creatingAnAstroDataType.html" title="4.3. Creating An AstroDataType"
             >previous</a> |</li>
        <li><a href="index.html">astrodata documentation v1.0beta documentation</a> &raquo;</li>
          <li><a href="developmentGuide.html" >4. AstroData Configuration Package Development Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Craig Allen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>