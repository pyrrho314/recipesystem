

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gempy.science.gmosScience &mdash; gempy v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="gempy v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../../index.html">gempy v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for gempy.science.gmosScience</h1><div class="highlight"><pre>
<span class="c"># Author: Kyle Mede, February 2011</span>
<span class="c"># For now, this module is to hold the code which performs the actual work of the </span>
<span class="c"># primitives that is considered generic enough to be at the &#39;GMOS&#39; level of</span>
<span class="c"># the hierarchy tree, but too specific for the &#39;gemini&#39; level above this.</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">pf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">astrodata.AstroData</span> <span class="kn">import</span> <span class="n">AstroData</span>
<span class="kn">from</span> <span class="nn">astrodata.adutils</span> <span class="kn">import</span> <span class="n">gemLog</span>
<span class="kn">from</span> <span class="nn">astrodata.adutils.gemutil</span> <span class="kn">import</span> <span class="n">pyrafLoader</span>
<span class="kn">from</span> <span class="nn">astrodata.Errors</span> <span class="kn">import</span> <span class="n">ScienceError</span>
<span class="kn">from</span> <span class="nn">gempy.instruments</span> <span class="kn">import</span> <span class="n">geminiTools</span>  <span class="k">as</span> <span class="n">gemt</span>
<span class="kn">from</span> <span class="nn">gempy.instruments</span> <span class="kn">import</span> <span class="n">gmosTools</span>  <span class="k">as</span> <span class="n">gmost</span>
<span class="kn">from</span> <span class="nn">gempy.instruments.geminiCLParDicts</span> <span class="kn">import</span> <span class="n">CLDefaultParamsDict</span>


<div class="viewcode-block" id="overscan_subtract"><a class="viewcode-back" href="../../../sciFunctions/function-overscan_subtract.html#gempy.science.gmosScience.overscan_subtract">[docs]</a><span class="k">def</span> <span class="nf">overscan_subtract</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">fl_trim</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fl_vardq</span><span class="o">=</span><span class="s">&#39;AUTO&#39;</span><span class="p">,</span> 
            <span class="n">biassec</span><span class="o">=</span><span class="s">&#39;[1:25,1:2304],[1:32,1:2304],[1025:1056,1:2304]&#39;</span><span class="p">,</span>
            <span class="n">outNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="s">&#39;gemini.log&#39;</span><span class="p">,</span> 
                                                <span class="n">logLevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noLogFile</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function uses the CL script gireduce to subtract the overscan </span>
<span class="sd">    from the input images.</span>
<span class="sd">    </span>
<span class="sd">    WARNING: </span>
<span class="sd">    The gireduce script used here replaces the previously </span>
<span class="sd">    calculated DQ frames with its own versions.  This may be corrected </span>
<span class="sd">    in the future by replacing the use of the gireduce</span>
<span class="sd">    with a Python routine to do the overscan subtraction.</span>

<span class="sd">    note</span>
<span class="sd">    The inputs to this function MUST be prepared.</span>

<span class="sd">    String representing the name of the log file to write all log messages to</span>
<span class="sd">    can be defined, or a default of &#39;gemini.log&#39; will be used.  If the file</span>
<span class="sd">    all ready exists in the directory you are working in, then this file will </span>
<span class="sd">    have the log messages during this function added to the end of it.</span>

<span class="sd">    FOR FUTURE</span>
<span class="sd">    This function has many GMOS dependencies that would be great to work out</span>
<span class="sd">    so that this could be made a more general function (say at the Gemini level)</span>
<span class="sd">    .  In the future the parameters can be looked into and the CL script can be </span>
<span class="sd">    upgraded to handle things like row based overscan calculations/fitting/</span>
<span class="sd">    modeling... vs the column based used right now, add the model, nbiascontam,</span>
<span class="sd">    ... params to the functions inputs so the user can choose them for </span>
<span class="sd">    themselves.</span>

<span class="sd">    :param adInputs: Astrodata inputs to be converted to Electron pixel units</span>
<span class="sd">    :type adInputs: Astrodata objects, either a single or a list of objects</span>
<span class="sd">    </span>
<span class="sd">    :param fl_trim: Trim the overscan region from the frames?</span>
<span class="sd">    :type fl_trim: Python boolean (True/False)</span>
<span class="sd">    </span>
<span class="sd">    :param fl_vardq: Create variance and data quality frames?</span>
<span class="sd">    :type fl_vardq: </span>
<span class="sd">        Python boolean (True/False), OR string &#39;AUTO&#39; to do </span>
<span class="sd">        it automatically if there are VAR and DQ frames in the inputs.</span>
<span class="sd">        NOTE: &#39;AUTO&#39; uses the first input to determine if VAR and DQ frames  </span>
<span class="sd">        exist, so, if the first does, then the rest MUST also have them as well.</span>

<span class="sd">    :param biassec: biassec parameter of format &#39;[#:#,#:#],[#:#,#:#],[#:#,#:#]&#39;</span>
<span class="sd">    :type biassec: string. </span>
<span class="sd">                   default: &#39;[1:25,1:2304],[1:32,1:2304],[1025:1056,1:2304]&#39; </span>
<span class="sd">                   is ideal for 2x2 GMOS data.</span>
<span class="sd">    </span>
<span class="sd">    :param outNames: filenames of output(s)</span>
<span class="sd">    :type outNames: String, either a single or a list of strings of same length </span>
<span class="sd">                    as adInputs.</span>
<span class="sd">    </span>
<span class="sd">    :param suffix: string to postpend on the end of the input filenames </span>
<span class="sd">                   (or outNames if not None) for the output filenames.</span>
<span class="sd">    :type suffix: string</span>
<span class="sd">    </span>
<span class="sd">    :param log: logger object to send log messges to</span>
<span class="sd">    :type log: A gemLog object from astrodata/adutils/gemLog.py .</span>
<span class="sd">               It is an upgraded version of the Python logger for use </span>
<span class="sd">               with all new scripts in gemini_python/ .</span>
<span class="sd">               Note: the logName, logLevel and noLogFile will be automatically</span>
<span class="sd">               determined from the logger object passed in to &#39;log&#39; with the </span>
<span class="sd">               ScienceFunctionManager.startUp() function.</span>
<span class="sd">    </span>
<span class="sd">    :param logName: Name of the log file, default is &#39;gemini.log&#39;</span>
<span class="sd">    :type logName: String, None causes default to be used.</span>
<span class="sd">    </span>
<span class="sd">    :param logLevel: </span>
<span class="sd">         verbosity setting for the log messages to screen,</span>
<span class="sd">         default is &#39;critical&#39; messages only.</span>
<span class="sd">         Note: independent of logLevel setting, all messages always go </span>
<span class="sd">         to the logfile if it is not turned off.</span>
<span class="sd">    :type logLevel: integer from 0-6, 0=nothing to screen, 6=everything to </span>
<span class="sd">                    screen. OR the message level as a string (ie. &#39;critical&#39;, </span>
<span class="sd">                    &#39;status&#39;, &#39;fullinfo&#39;...)</span>

<span class="sd">    :param noLogFile: A boolean to make it so no log file is created</span>
<span class="sd">    :type noLogFile: Python boolean (True/False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Instantiate ScienceFunctionManager object</span>
    <span class="n">sfm</span> <span class="o">=</span> <span class="n">gemt</span><span class="o">.</span><span class="n">ScienceFunctionManager</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span>
                                      <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span><span class="p">,</span> 
                                      <span class="n">funcName</span><span class="o">=</span><span class="s">&#39;overscan_subtract&#39;</span><span class="p">)</span> 
    <span class="c"># Perform start up checks of the inputs, prep/check of outnames, and get log</span>
    <span class="c"># and the log params for later use if needed.</span>
    <span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">startUp</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span> 
        <span class="c"># loading and bringing the pyraf related modules into the name-space</span>
        <span class="n">pyraf</span><span class="p">,</span> <span class="n">gemini</span><span class="p">,</span> <span class="n">yes</span><span class="p">,</span> <span class="n">no</span> <span class="o">=</span> <span class="n">pyrafLoader</span><span class="p">()</span> 
         
        <span class="c"># Creating empty list of ad&#39;s to be returned that will be filled below</span>
        <span class="n">adOutputs</span><span class="o">=</span><span class="p">[]</span>
                
        <span class="c"># Converting input True/False to yes/no or detecting fl_vardq value</span>
        <span class="c"># if &#39;AUTO&#39; chosen with autoVardq in the ScienceFunctionManager</span>
        <span class="n">fl_vardq</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">autoVardq</span><span class="p">(</span><span class="n">fl_vardq</span><span class="p">)</span>
        
        <span class="c"># To clean up log and screen if multiple inputs</span>
        <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&#39;format&#39;</span><span class="p">)</span>                                 
            
        <span class="c"># Preparing input files, lists, parameters... for input to </span>
        <span class="c"># the CL script</span>
        <span class="n">clm</span><span class="o">=</span><span class="n">gemt</span><span class="o">.</span><span class="n">CLManager</span><span class="p">(</span><span class="n">imageIns</span><span class="o">=</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">imageOutsNames</span><span class="o">=</span><span class="n">outNames</span><span class="p">,</span>  
                           <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">funcName</span><span class="o">=</span><span class="s">&#39;overscanSubtract&#39;</span><span class="p">,</span>   
                           <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">,</span> 
                           <span class="n">noLogFile</span><span class="o">=</span><span class="n">noLogFile</span><span class="p">)</span>
        
        <span class="c"># Check the status of the CLManager object, True=continue, False= issue warning</span>
        <span class="k">if</span> <span class="n">clm</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>                     
            <span class="c"># Parameters set by the gemt.CLManager or the definition </span>
            <span class="c"># of the primitive </span>
            <span class="n">clPrimParams</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s">&#39;inimages&#39;</span>    <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">imageInsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
              <span class="s">&#39;gp_outpref&#39;</span>  <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span>
              <span class="s">&#39;outimages&#39;</span>   <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">imageOutsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">),</span>
              <span class="c"># This returns a unique/temp log file for IRAF</span>
              <span class="s">&#39;logfile&#39;</span>     <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">templog</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>      
              <span class="s">&#39;fl_over&#39;</span>     <span class="p">:</span><span class="n">yes</span><span class="p">,</span> 
              <span class="c"># This is actually in the default dict but wanted to show it again</span>
              <span class="s">&#39;Stdout&#39;</span>      <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">IrafStdout</span><span class="p">(</span><span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span><span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">),</span> 
              <span class="c"># This is actually in the default dict but wanted to show it again</span>
              <span class="s">&#39;Stderr&#39;</span>      <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">IrafStdout</span><span class="p">(</span><span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span><span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">),</span> 
              <span class="c"># This is actually in the default dict but wanted to show it again</span>
              <span class="s">&#39;verbose&#39;</span>     <span class="p">:</span><span class="n">yes</span>                
                          <span class="p">}</span>
            
            <span class="c"># Taking care of the biasec-&gt;nbiascontam param</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">biassec</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">nbiascontam</span> <span class="o">=</span> <span class="n">gemt</span><span class="o">.</span><span class="n">nbiascontam</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">biassec</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span> 
                                               <span class="n">logLevel</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;nbiascontam parameter was updated to = &#39;</span><span class="o">+</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">nbiascontam</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="c"># Do not try to calculate it, just use default value of 4.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;Using default nbiascontam parameter = 4&#39;</span><span class="p">)</span>
                <span class="n">nbiascontam</span> <span class="o">=</span> <span class="mi">4</span>
            
            <span class="c"># Parameters from the Parameter file that are adjustable by the user</span>
            <span class="n">clSoftcodedParams</span> <span class="o">=</span> <span class="p">{</span>
               <span class="c"># pyrafBoolean converts the python booleans to pyraf ones</span>
               <span class="s">&#39;fl_trim&#39;</span>    <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">pyrafBoolean</span><span class="p">(</span><span class="n">fl_trim</span><span class="p">),</span>
               <span class="s">&#39;outpref&#39;</span>    <span class="p">:</span><span class="n">suffix</span><span class="p">,</span>
               <span class="s">&#39;fl_vardq&#39;</span>   <span class="p">:</span><span class="n">fl_vardq</span><span class="p">,</span>
               <span class="s">&#39;nbiascontam&#39;</span><span class="p">:</span><span class="n">nbiascontam</span>
                               <span class="p">}</span>
            <span class="c"># Grabbing the default params dict and updating it with </span>
            <span class="c"># the two above dicts</span>
            <span class="n">clParamsDict</span> <span class="o">=</span> <span class="n">CLDefaultParamsDict</span><span class="p">(</span><span class="s">&#39;gireduce&#39;</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span>
                                               <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
            <span class="n">clParamsDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clPrimParams</span><span class="p">)</span>
            <span class="n">clParamsDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clSoftcodedParams</span><span class="p">)</span>
            
            <span class="c"># Logging the parameters that were not defaults</span>
            <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Parameters set automatically:&#39;</span><span class="p">,</span> 
                         <span class="n">category</span><span class="o">=</span><span class="s">&#39;parameters&#39;</span><span class="p">)</span>
            <span class="c"># Loop through the parameters in the clPrimParams dictionary</span>
            <span class="c"># and log them</span>
            <span class="n">gemt</span><span class="o">.</span><span class="n">logDictParams</span><span class="p">(</span><span class="n">clPrimParams</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
            
            <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Parameters adjustable by the user:&#39;</span><span class="p">,</span> 
                         <span class="n">category</span><span class="o">=</span><span class="s">&#39;parameters&#39;</span><span class="p">)</span>
            <span class="c"># Loop through the parameters in the clSoftcodedParams </span>
            <span class="c"># dictionary and log them</span>
            <span class="n">gemt</span><span class="o">.</span><span class="n">logDictParams</span><span class="p">(</span><span class="n">clSoftcodedParams</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span> 
                               <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
            
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Calling the gireduce CL script for inputs &#39;</span><span class="o">+</span>
                  <span class="n">clm</span><span class="o">.</span><span class="n">imageInsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">))</span>
        
            <span class="n">gemini</span><span class="o">.</span><span class="n">gmos</span><span class="o">.</span><span class="n">gireduce</span><span class="p">(</span><span class="o">**</span><span class="n">clParamsDict</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">gemini</span><span class="o">.</span><span class="n">gmos</span><span class="o">.</span><span class="n">gireduce</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;gireduce failed for inputs &#39;</span><span class="o">+</span>
                             <span class="n">clm</span><span class="o">.</span><span class="n">imageInsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;Exited the gireduce CL script successfully&#39;</span><span class="p">)</span>
            
            <span class="c"># Renaming CL outputs and loading them back into memory, and </span>
            <span class="c"># cleaning up the intermediate tmp files written to disk</span>
            <span class="c"># refOuts and arrayOuts are None here</span>
            <span class="n">imageOuts</span><span class="p">,</span> <span class="n">refOuts</span><span class="p">,</span> <span class="n">arrayOuts</span> <span class="o">=</span> <span class="n">clm</span><span class="o">.</span><span class="n">finishCL</span><span class="p">()</span> 
            
            <span class="c"># Renaming for symmetry</span>
            <span class="n">adOutputs</span><span class="o">=</span><span class="n">imageOuts</span>
            
            <span class="c"># Wrap up logging</span>
            <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">adOut</span> <span class="ow">in</span> <span class="n">adOutputs</span><span class="p">:</span>
                <span class="c"># Verifying gireduce was actually ran on the file</span>
                <span class="k">if</span> <span class="n">adOut</span><span class="o">.</span><span class="n">phuGetKeyValue</span><span class="p">(</span><span class="s">&#39;GIREDUCE&#39;</span><span class="p">):</span> 
                    <span class="c"># If gireduce was ran, then log the changes to the files </span>
                    <span class="c"># it made</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">File &#39;</span><span class="o">+</span><span class="n">clm</span><span class="o">.</span><span class="n">preCLimageNames</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span>
                                 <span class="s">&#39; had its overscan subracted successfully&#39;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;New file name is: &#39;</span><span class="o">+</span><span class="n">adOut</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="c"># Updating GEM-TLM and OVERSUB time stamps in the PHU</span>
                <span class="n">adOut</span><span class="o">.</span><span class="n">historyMark</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s">&#39;OVERSUB&#39;</span><span class="p">,</span> <span class="n">stomp</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  
                
                <span class="c"># Updating GEM-TLM (automatic) and BIASCORR time stamps to the PHU</span>
                <span class="c"># and updating logger with updated/added time stamps</span>
                <span class="n">sfm</span><span class="o">.</span><span class="n">markHistory</span><span class="p">(</span><span class="n">adOutputs</span><span class="o">=</span><span class="n">adOut</span><span class="p">,</span> <span class="n">historyMarkKey</span><span class="o">=</span><span class="s">&#39;OVERSUB&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;One of the inputs has not been prepared,</span><span class="se">\</span>
<span class="s">            the overscanSubtract function can only work on prepared data.&#39;</span><span class="p">)</span>
        
        <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;**FINISHED** the overscan_subtract function&#39;</span><span class="p">)</span>
        
        <span class="c"># Return the outputs list, even if there is only one output</span>
        <span class="k">return</span> <span class="n">adOutputs</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c"># logging the exact message from the actual exception that was raised</span>
        <span class="c"># in the try block. Then raising a general ScienceError with message.</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;An error occurred while trying to run </span><span class="se">\</span>
<span class="s">                                                            overscan_subtract&#39;</span><span class="p">)</span>    
                </div>
<div class="viewcode-block" id="fringe_correct"><a class="viewcode-back" href="../../../sciFunctions/function-fringe_correct.html#gempy.science.gmosScience.fringe_correct">[docs]</a><span class="k">def</span> <span class="nf">fringe_correct</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">fringes</span><span class="p">,</span> <span class="n">fl_statscale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">statsec</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">outNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="s">&#39;gemini.log&#39;</span><span class="p">,</span> 
            <span class="n">logLevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noLogFile</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This primitive will scale and subtract the fringe frame from the inputs.</span>
<span class="sd">    It utilizes the Python re-written version of cl script girmfringe now called</span>
<span class="sd">    rmImgFringe in gmosTools to do the work.</span>
<span class="sd">    </span>
<span class="sd">    NOTE:</span>
<span class="sd">    String representing the name of the log file to write all log messages to</span>
<span class="sd">    can be defined, or a default of &#39;gemini.log&#39; will be used.  If the file</span>
<span class="sd">    all ready exists in the directory you are working in, then this file will </span>
<span class="sd">    have the log messages during this function added to the end of it.</span>

<span class="sd">    FOR FUTURE</span>
<span class="sd">    This function has many GMOS dependencies that would be great to work out</span>
<span class="sd">    so that this could be made a more general function (say at the Gemini level)</span>
<span class="sd">    .</span>
<span class="sd">    </span>
<span class="sd">    :param adInputs: Astrodata input(s) to be fringe corrected</span>
<span class="sd">    :type adInputs: Astrodata objects, either a single or a list of objects</span>
<span class="sd">    </span>
<span class="sd">    :param fringes: Astrodata input fringe(s)</span>
<span class="sd">    :type fringes: AstroData objects in a list, or a single instance.</span>
<span class="sd">                   Note: If there is multiple inputs and one fringe provided, </span>
<span class="sd">                   then the same fringe will be applied to all inputs; else the   </span>
<span class="sd">                   fringes list must match the length of the inputs.</span>
<span class="sd">    </span>
<span class="sd">    :param fl_statscale: Scale by statistics rather than exposure time</span>
<span class="sd">    :type fl_statscale: Boolean</span>
<span class="sd">    </span>
<span class="sd">    :param statsec: image section used to determine the scale factor </span>
<span class="sd">                    if fl_statsec=True</span>
<span class="sd">    :type statsec: string of format &#39;[EXTNAME,EXTVER][x1:x2,y1:y2]&#39;</span>
<span class="sd">                   default: If CCDSUM = &#39;1 1&#39; :[SCI,2][100:1900,100:4500]&#39;</span>
<span class="sd">                   If CCDSUM = &#39;2 2&#39; : [SCI,2][100:950,100:2250]&#39;</span>
<span class="sd">    </span>
<span class="sd">    :param scale: Override auto-scaling if not 0.0</span>
<span class="sd">    :type scale: real</span>

<span class="sd">    :param outNames: filenames of output(s)</span>
<span class="sd">    :type outNames: String, either a single or a list of strings of same </span>
<span class="sd">                    length as adInputs.</span>
<span class="sd">    </span>
<span class="sd">    :param suffix: string to postpend on the end of the input filenames </span>
<span class="sd">                   (or outNames if not None) for the output filenames.</span>
<span class="sd">    :type suffix: string</span>
<span class="sd">    </span>
<span class="sd">    :param log: logger object to send log messges to</span>
<span class="sd">    :type log: A gemLog object from astrodata/adutils/gemLog.py .</span>
<span class="sd">               It is an upgraded version of the Python logger for use </span>
<span class="sd">               with all new scripts in gemini_python/ .</span>
<span class="sd">               Note: the logName, logLevel and noLogFile will be automatically</span>
<span class="sd">               determined from the logger object passed in to &#39;log&#39; with the </span>
<span class="sd">               ScienceFunctionManager.startUp() function.</span>
<span class="sd">    </span>
<span class="sd">    :param logName: Name of the log file, default is &#39;gemini.log&#39;</span>
<span class="sd">    :type logName: String, None causes default to be used.</span>
<span class="sd">    </span>
<span class="sd">    :param logLevel: </span>
<span class="sd">         verbosity setting for the log messages to screen,</span>
<span class="sd">         default is &#39;critical&#39; messages only.</span>
<span class="sd">         Note: independent of logLevel setting, all messages always go </span>
<span class="sd">         to the logfile if it is not turned off.</span>
<span class="sd">    :type logLevel: integer from 0-6, 0=nothing to screen, 6=everything </span>
<span class="sd">                    to screen. OR the message level as a string (ie. &#39;critical&#39;,  </span>
<span class="sd">                    &#39;status&#39;, &#39;fullinfo&#39;...)</span>

<span class="sd">    :param noLogFile: A boolean to make it so no log file is created</span>
<span class="sd">    :type noLogFile: Python boolean (True/False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Instantiate ScienceFunctionManager object</span>
    <span class="n">sfm</span> <span class="o">=</span> <span class="n">gemt</span><span class="o">.</span><span class="n">ScienceFunctionManager</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span>
                                      <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span><span class="p">,</span> 
                                      <span class="n">funcName</span><span class="o">=</span><span class="s">&#39;fringe_correct&#39;</span><span class="p">)</span> 
    <span class="c"># Perform start up checks of the inputs, prep/check of outnames, and get log</span>
    <span class="c"># and the log params for later use if needed.</span>
    <span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">startUp</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Set up counter for looping through outNames/BPMs lists</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="c"># Creating empty list of ad&#39;s to be returned that will be filled below</span>
        <span class="n">adOutputs</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="c"># Casting &#39;fringes&#39; into a list if not one yet</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fringes</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">fringes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fringes</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">fringes</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;There must be at least one astrodata instance</span><span class="se">\</span>
<span class="s">                                passed in for the &quot;fringes&quot; parameter&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ad</span> <span class="ow">in</span> <span class="n">adInputs</span><span class="p">:</span>
            <span class="c"># Loading up a dictionary with the input parameters for rmImgFringe</span>
            <span class="n">paramDict</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="s">&#39;inimage&#39;</span>        <span class="p">:</span><span class="n">ad</span><span class="p">,</span>
                         <span class="s">&#39;fringe&#39;</span>         <span class="p">:</span><span class="n">fringes</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                         <span class="s">&#39;fl_statscale&#39;</span>   <span class="p">:</span><span class="n">fl_statscale</span><span class="p">,</span>
                         <span class="s">&#39;statsec&#39;</span>        <span class="p">:</span><span class="n">statsec</span><span class="p">,</span>
                         <span class="s">&#39;scale&#39;</span>          <span class="p">:</span><span class="n">scale</span><span class="p">,</span>
                         <span class="s">&#39;logLevel&#39;</span>       <span class="p">:</span><span class="n">logLevel</span>
                         <span class="p">}</span>
            
            <span class="c"># Logging values set in the parameters dictionary above</span>
            <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Parameters being used for rmImgFringe &#39;</span><span class="o">+</span>
                         <span class="s">&#39;function:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">gemt</span><span class="o">.</span><span class="n">logDictParams</span><span class="p">(</span><span class="n">paramDict</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
            
            <span class="c"># Calling the rmImgFringe function to perform the fringe </span>
            <span class="c"># corrections, this function will return the corrected image as</span>
            <span class="c"># an AstroData instance</span>
            <span class="n">adOut</span> <span class="o">=</span> <span class="n">gmost</span><span class="o">.</span><span class="n">rmImgFringe</span><span class="p">(</span><span class="o">**</span><span class="n">paramDict</span><span class="p">)</span>
            
            <span class="c"># renaming the output ad filename</span>
            <span class="n">adOut</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">outNames</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
                    
            <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;File name updated to &#39;</span><span class="o">+</span><span class="n">adOut</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            
            <span class="c"># Updating GEM-TLM (automatic) and BIASCORR time stamps to the PHU</span>
            <span class="c"># and updating logger with updated/added time stamps</span>
            <span class="n">sfm</span><span class="o">.</span><span class="n">markHistory</span><span class="p">(</span><span class="n">adOutputs</span><span class="o">=</span><span class="n">adOut</span><span class="p">,</span> <span class="n">historyMarkKey</span><span class="o">=</span><span class="s">&#39;RMFRINGE&#39;</span><span class="p">)</span>
        
            <span class="c"># Appending to output list</span>
            <span class="n">adOutputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adOut</span><span class="p">)</span>
    
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
                
        <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;**FINISHED** the fringe_correct function&#39;</span><span class="p">)</span>
        <span class="c"># Return the outputs (list or single, matching adInputs)</span>
        <span class="k">return</span> <span class="n">adOutputs</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c"># logging the exact message from the actual exception that was raised</span>
        <span class="c"># in the try block. Then raising a general ScienceError with message.</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;An error occurred while trying to run </span><span class="se">\</span>
<span class="s">                                                                fringe_correct&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="make_fringe_frame_imaging"><a class="viewcode-back" href="../../../sciFunctions/function-make_fringe_frame_imaging.html#gempy.science.gmosScience.make_fringe_frame_imaging">[docs]</a><span class="k">def</span> <span class="nf">make_fringe_frame_imaging</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">fl_vardq</span><span class="o">=</span><span class="s">&#39;AUTO&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;median&#39;</span><span class="p">,</span> 
            <span class="n">outNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="s">&#39;gemini.log&#39;</span><span class="p">,</span> 
                                                <span class="n">logLevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noLogFile</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will create and return a single fringe image from all the </span>
<span class="sd">    inputs.  It utilizes the CL script gifringe to create the fringe image.</span>
<span class="sd">    </span>
<span class="sd">    NOTE: The inputs to this function MUST be prepared. </span>

<span class="sd">    A string representing the name of the log file to write all log messages to</span>
<span class="sd">    can be defined, or a default of &#39;gemini.log&#39; will be used.  If the file</span>
<span class="sd">    all ready exists in the directory you are working in, then this file will </span>
<span class="sd">    have the log messages during this function added to the end of it.</span>
<span class="sd">    </span>
<span class="sd">    :param adInputs: Astrodata inputs to be combined</span>
<span class="sd">    :type adInputs: Astrodata objects, either a single or a list of objects</span>
<span class="sd">    </span>
<span class="sd">    :param fl_vardq: Create variance and data quality frames?</span>
<span class="sd">    :type fl_vardq: Python boolean (True/False), OR string &#39;AUTO&#39; to do </span>
<span class="sd">                    it automatically if there are VAR and DQ frames in the </span>
<span class="sd">                    inputs.</span>
<span class="sd">                    NOTE: &#39;AUTO&#39; uses the first input to determine if VAR and DQ  </span>
<span class="sd">                    frames exist, so, if the first does, then the rest MUST also </span>
<span class="sd">                    have them as well.</span>
<span class="sd">    </span>
<span class="sd">    :param method: type of combining method to use.</span>
<span class="sd">    :type method: string, options: &#39;average&#39;, &#39;median&#39;.</span>
<span class="sd">    </span>
<span class="sd">    :param outNames: filenames of output(s)</span>
<span class="sd">    :type outNames: String, either a single or a list of strings of same length</span>
<span class="sd">                    as adInputs.</span>
<span class="sd">    </span>
<span class="sd">    :param suffix: string to add on the end of the input filenames </span>
<span class="sd">                    (or outNames if not None) for the output filenames.</span>
<span class="sd">    :type suffix: string</span>
<span class="sd">    </span>
<span class="sd">    :param log: logger object to send log messges to</span>
<span class="sd">    :type log: A gemLog object from astrodata/adutils/gemLog.py .</span>
<span class="sd">               It is an upgraded version of the Python logger for use </span>
<span class="sd">               with all new scripts in gemini_python/ .</span>
<span class="sd">               Note: the logName, logLevel and noLogFile will be automatically</span>
<span class="sd">               determined from the logger object passed in to &#39;log&#39; with the </span>
<span class="sd">               ScienceFunctionManager.startUp() function.</span>
<span class="sd">    </span>
<span class="sd">    :param logName: Name of the log file, default is &#39;gemini.log&#39;</span>
<span class="sd">    :type logName: String, None causes default to be used.</span>
<span class="sd">    </span>
<span class="sd">    :param logLevel: verbosity setting for the log messages to screen,</span>
<span class="sd">                    default is &#39;critical&#39; messages only.</span>
<span class="sd">                    Note: independent of logLevel setting, all messages always  </span>
<span class="sd">                    go to the logfile if it is not turned off.</span>
<span class="sd">    :type logLevel: integer from 0-6, 0=nothing to screen, 6=everything to </span>
<span class="sd">                    screen. OR the message level as a string (ie. &#39;critical&#39;,  </span>
<span class="sd">                    &#39;status&#39;, &#39;fullinfo&#39;...)</span>
<span class="sd">                    </span>
<span class="sd">    :param noLogFile: A boolean to make it so no log file is created</span>
<span class="sd">    :type noLogFile: Python boolean (True/False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># Instantiate ScienceFunctionManager object</span>
    <span class="n">sfm</span> <span class="o">=</span> <span class="n">gemt</span><span class="o">.</span><span class="n">ScienceFunctionManager</span><span class="p">(</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span>
                                       <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span><span class="p">,</span> 
                                       <span class="n">funcName</span><span class="o">=</span><span class="s">&#39;make_fringe_frame_imaging&#39;</span><span class="p">,</span> 
                                       <span class="n">combinedInputs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Perform start up checks of the inputs, prep/check of outnames, and get log</span>
    <span class="c"># and the log params for later use if needed.</span>
    <span class="n">adInputs</span><span class="p">,</span> <span class="n">outNames</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">logName</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">startUp</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Set up counter for looping through outNames list</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="c"># Ensuring there is more than one input to make a fringe frame from</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adInputs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
            
            <span class="c"># loading and bringing the pyraf related modules into the name-space</span>
            <span class="n">pyraf</span><span class="p">,</span> <span class="n">gemini</span><span class="p">,</span> <span class="n">yes</span><span class="p">,</span> <span class="n">no</span> <span class="o">=</span> <span class="n">pyrafLoader</span><span class="p">()</span> 
             
            <span class="c"># Creating empty list of ad&#39;s to be returned that will be filled below</span>
            <span class="n">adOutputs</span><span class="o">=</span><span class="p">[]</span>
                    
            <span class="c"># Converting input True/False to yes/no or detecting fl_vardq value</span>
            <span class="c"># if &#39;AUTO&#39; chosen with autoVardq in the ScienceFunctionManager</span>
            <span class="n">fl_vardq</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">autoVardq</span><span class="p">(</span><span class="n">fl_vardq</span><span class="p">)</span>
            
            <span class="c"># To clean up log and screen if multiple inputs</span>
            <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&#39;format&#39;</span><span class="p">)</span>                                 
                
            <span class="c"># Preparing input files, lists, parameters... for input to </span>
            <span class="c"># the CL script</span>
            <span class="n">clm</span><span class="o">=</span><span class="n">gemt</span><span class="o">.</span><span class="n">CLManager</span><span class="p">(</span><span class="n">imageIns</span><span class="o">=</span><span class="n">adInputs</span><span class="p">,</span> <span class="n">imageOutsNames</span><span class="o">=</span><span class="n">outNames</span><span class="p">,</span>  
                               <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">funcName</span><span class="o">=</span><span class="s">&#39;makeFringeFrame&#39;</span><span class="p">,</span> 
                               <span class="n">combinedImages</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span>   
                               <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">,</span> <span class="n">noLogFile</span><span class="o">=</span><span class="n">noLogFile</span><span class="p">)</span>
            
            <span class="c"># Check the status of the CLManager object, True=continue, False= issue warning</span>
            <span class="k">if</span> <span class="n">clm</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>                     
            
                <span class="c"># Parameters set by the gemt.CLManager or the definition </span>
                <span class="c"># of the primitive </span>
                <span class="n">clPrimParams</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="c"># Retrieving the inputs as a list from the CLManager</span>
                    <span class="s">&#39;inimages&#39;</span>    <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">imageInsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;listFile&#39;</span><span class="p">),</span>
                    <span class="c"># Maybe allow the user to override this in the future. </span>
                    <span class="s">&#39;outimage&#39;</span>    <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">imageOutsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">),</span> 
                    <span class="c"># This returns a unique/temp log file for IRAF  </span>
                    <span class="s">&#39;logfile&#39;</span>     <span class="p">:</span><span class="n">clm</span><span class="o">.</span><span class="n">templog</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>  
                    <span class="c"># This is actually in the default dict but wanted to </span>
                    <span class="c"># show it again       </span>
                    <span class="s">&#39;Stdout&#39;</span>      <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">IrafStdout</span><span class="p">(</span><span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span><span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">),</span> 
                    <span class="c"># This is actually in the default dict but wanted to </span>
                    <span class="c"># show it again    </span>
                    <span class="s">&#39;Stderr&#39;</span>      <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">IrafStdout</span><span class="p">(</span><span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span><span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">),</span>
                    <span class="c"># This is actually in the default dict but wanted to </span>
                    <span class="c"># show it again     </span>
                    <span class="s">&#39;verbose&#39;</span>     <span class="p">:</span><span class="n">yes</span>                    
                              <span class="p">}</span>
    
                <span class="c"># Creating a dictionary of the parameters from the Parameter </span>
                <span class="c"># file adjustable by the user</span>
                <span class="n">clSoftcodedParams</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;fl_vardq&#39;</span>      <span class="p">:</span><span class="n">gemt</span><span class="o">.</span><span class="n">pyrafBoolean</span><span class="p">(</span><span class="n">fl_vardq</span><span class="p">),</span>
                    <span class="s">&#39;combine&#39;</span>       <span class="p">:</span><span class="n">method</span><span class="p">,</span>
                    <span class="s">&#39;reject&#39;</span>        <span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="p">}</span>
                <span class="c"># Grabbing the default parameters dictionary and updating </span>
                <span class="c"># it with the two above dictionaries</span>
                <span class="n">clParamsDict</span> <span class="o">=</span> <span class="n">CLDefaultParamsDict</span><span class="p">(</span><span class="s">&#39;gifringe&#39;</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span>
                                                   <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
                <span class="n">clParamsDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clPrimParams</span><span class="p">)</span>
                <span class="n">clParamsDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clSoftcodedParams</span><span class="p">)</span>
                
                <span class="c"># Logging the values in the soft and prim parameter dictionaries</span>
                <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Parameters set by the CLManager or  &#39;</span><span class="o">+</span>
                         <span class="s">&#39;dictated by the definition of the primitive:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> 
                         <span class="n">category</span><span class="o">=</span><span class="s">&#39;parameters&#39;</span><span class="p">)</span>
                <span class="n">gemt</span><span class="o">.</span><span class="n">logDictParams</span><span class="p">(</span><span class="n">clPrimParams</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span> 
                                   <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">fullinfo</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">User adjustable parameters in the &#39;</span><span class="o">+</span>
                             <span class="s">&#39;parameters file:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&#39;parameters&#39;</span><span class="p">)</span>
                <span class="n">gemt</span><span class="o">.</span><span class="n">logDictParams</span><span class="p">(</span><span class="n">clSoftcodedParams</span><span class="p">,</span> <span class="n">logName</span><span class="o">=</span><span class="n">logName</span><span class="p">,</span>
                                   <span class="n">logLevel</span><span class="o">=</span><span class="n">logLevel</span><span class="p">)</span>
                
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Calling the gifringe CL script for input list &#39;</span><span class="o">+</span>
                              <span class="n">clm</span><span class="o">.</span><span class="n">imageInsFiles</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;listFile&#39;</span><span class="p">))</span>
                
                <span class="n">gemini</span><span class="o">.</span><span class="n">gifringe</span><span class="p">(</span><span class="o">**</span><span class="n">clParamsDict</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">gemini</span><span class="o">.</span><span class="n">gifringe</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;gifringe failed for inputs &#39;</span><span class="o">+</span>
                                 <span class="n">rc</span><span class="o">.</span><span class="n">inputsAsStr</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;Exited the gifringe CL script successfully&#39;</span><span class="p">)</span>
                    
                <span class="c"># Renaming CL outputs and loading them back into memory </span>
                <span class="c"># and cleaning up the intermediate temp files written to disk</span>
                <span class="c"># refOuts and arrayOuts are None here</span>
                <span class="n">imageOuts</span><span class="p">,</span> <span class="n">refOuts</span><span class="p">,</span> <span class="n">arrayOuts</span> <span class="o">=</span> <span class="n">clm</span><span class="o">.</span><span class="n">finishCL</span><span class="p">()</span> 
                
                <span class="c"># Renaming for symmetry</span>
                <span class="n">adOutputs</span><span class="o">=</span><span class="n">imageOuts</span>
            
                <span class="c"># Renaming for symmetry</span>
                <span class="n">adOutputs</span><span class="o">=</span><span class="n">imageOuts</span>
                
                <span class="c"># Updating GEM-TLM (automatic) and COMBINE time stamps to the PHU</span>
                <span class="c"># and updating logger with updated/added time stamps</span>
                <span class="n">sfm</span><span class="o">.</span><span class="n">markHistory</span><span class="p">(</span><span class="n">adOutputs</span><span class="o">=</span><span class="n">adOutputs</span><span class="p">,</span> <span class="n">historyMarkKey</span><span class="o">=</span><span class="s">&#39;FRINGE&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;One of the inputs has not been prepared,</span><span class="se">\</span>
<span class="s">                the combine function can only work on prepared data.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Only one input was passed in for adInputs, so </span><span class="se">\</span>
<span class="s">                    make_fringe_frame_imaging is simply passing the inputs  </span><span class="se">\</span>
<span class="s">                    into the outputs list without doing anything to them.&#39;</span><span class="p">)</span>
            <span class="n">adOutputs</span> <span class="o">=</span> <span class="n">adInputs</span>
        
        <span class="n">log</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;**FINISHED** the make_fringe_frame_imaging function&#39;</span><span class="p">)</span>
        
        <span class="c"># Return the outputs list, even if there is only one output</span>
        <span class="k">return</span> <span class="n">adOutputs</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c"># logging the exact message from the actual exception that was raised</span>
        <span class="c"># in the try block. Then raising a general ScienceError with message.</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">raise</span> <span class="n">ScienceError</span><span class="p">(</span><span class="s">&#39;An error occurred while trying to run </span><span class="se">\</span>
<span class="s">                                                    make_fringe_frame_imaging&#39;</span><span class="p">)</span>
    
    
    
    </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../../index.html">gempy v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, nz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>